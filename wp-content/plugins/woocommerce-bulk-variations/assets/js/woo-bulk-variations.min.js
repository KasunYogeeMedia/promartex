jQuery(document).ready(function(){var e=jQuery(".wcbv-wrapper"),t=jQuery(".variations_form"),i=t.find(".variations select"),n=jQuery('[name="_wcbv_variations"]:first').parents("form:first"),a=null,c=!0,r=function(n){a=null,t.find("select").val("").change();var c=e.children(".wcbv-variations").append('<div class="wcbv-row wcbv-clearfix"><div class="wcbv-fields wcbv-clearfix"><div class="wcbv-selects wcbv-columns wcbv-two"></div></div><div class="wcbv-price"></div></div>').children(".wcbv-row:last").children(".wcbv-fields");i.each(function(e,t){var i=jQuery(t),a=n&&n.hasOwnProperty(t.name)?n[t.name]:"",r=jQuery('<div><select data-attribute="'+t.name+'" value="'+a+'"></select></div>');r.children("select").html(i.html()).val(a),c.children(".wcbv-selects").append(r)}),c.append('<div class="wcbv-quantity"><input type="number" value=1 min=0 step=1></div><div class="wcbv-remove"><span class="wcbv-remove-row">x</span></div>'),jQuery().select2&&wcbvOptions.enableSelect&&c.find("select").select2({dropdownCssClass:"wcbv-select2",width:"100%"}),c.find("select:last").change()},v=function(){var t=0,i=Number(e.find(".wcbv-total-price .wcbv-price-value").text()),n=0;"undefined"!=typeof fancyProductDesigner&&(n=parseFloat(fancyProductDesigner.calculatePrice())),e.find(".wcbv-variations .wcbv-row").each(function(e,i){var a=jQuery(i);if(a.data("variation")&&a.find(".wcbv-quantity input").val().length>0){var c=a.find(".wcbv-quantity input").val(),r=a.data("variation");if(!isNaN(c)&&c>0&&r.price){var v=(r.price+n)*c;v=s(v,r.wcbv_discounts,c),(t+=v)%1!=0&&(t=Number(t.toFixed(2)))}}}),e.find(".wcbv-total-price .wcbv-price-value").text(l(t)).parents(".wcbv-total-price").toggle(t>0),t!==i&&e.trigger("priceChange",[t])},s=function(e,t,i){return t&&t.some(function(t){if(o(t.operator,i,t.qty)){if("perc"==t.type){var n=Number(t.discount)/100;e-=e*n}else e-=t.discount;return!0}return!1}),e},o=function(e,t,i){return t=parseInt(t),i=parseInt(i),"="===e?t===i:">"===e?t>i:"<"===e?t<i:">="===e?t>=i:"<="===e?t<=i:void 0},l=function(e){var t=wcbvOptions.priceThousandSep,i=wcbvOptions.priceDecimalSep,n=e.toString().split("."),a=n[0],c=n[1],r="";if(void 0!==a){for(var v=a.length-1;v>=0;v--)r+=a.charAt(v);(r=r.replace(/(\d{3})/g,"$1"+t)).slice(-t.length)==t&&(r=r.slice(0,-t.length)),a="";for(v=r.length-1;v>=0;v--)a+=r.charAt(v);void 0!==c&&c.length>0&&(1==c.length?c+="0":c.length>2&&(c=c.substring(0,2)),a+=i+c)}return a};wcbvOptions.replaceChooseOption&&i.each(function(e,t){jQuery(t).children("option:first").text(wcbvOptions.attributeNames[e])});var d=n.find(".reset_variations").clone().removeClass("reset_variations").addClass("wcbv-reset-variations");if(e.find(".wcbv-actions").append(d),e.on("change",".wcbv-fields select",function(){var e=(a=jQuery(this)).parents(".wcbv-row:first");a.parent("div").removeClass("wcbv-error"),t.find("select").each(function(t,i){jQuery(i).val(e.find('select[data-attribute="'+i.name+'"]').val()).change()}).filter('select[name="'+a.data("attribute")+'"]').val(a.val()).change(),t.find('select:not([name="'+a.data("attribute")+'"])').each(function(t,i){var n=e.find('[data-attribute="'+this.name+'"]'),a=n.val();n.html(jQuery(i).html()).val(a)})}),e.on("click","#wcbv-add-row",function(){r(wcbvOptions.selectedAttributes)}).on("change keyup",".wcbv-quantity input",function(){v()}).on("click",".wcbv-remove-row",function(){c=!1,jQuery(this).parents(".wcbv-row").remove(),e.find(".wcbv-row:first select").each(function(e,i){var n=jQuery(i);t.find('select[name="'+n.data("attribute")+'"]').val(n.val())}).last().change(),c=!0}).on("click",".wcbv-reset-variations",function(t){t.preventDefault(),e.find(".wcbv-variations select").val("").change(),e.find(".wcbv-quantity input").val("1"),n.find(".reset_variations").click()}),n.on("show_variation",function(e,t,n){if(a&&void 0!==t.display_price){var c={variation_id:t.variation_id,price:t.display_price,wcbv_discounts:t.wcbv_discounts},r={};i.each(function(e,t){r[t.name]=t.value}),c.attributes=r,t.price_html&&t.price_html.length>0?a.parents(".wcbv-row:first").data("variation",c).addClass("wcbv-show-price").children(".wcbv-price").html(jQuery(t.price_html).find(".amount:last").text()):void 0!==t.display_price&&a.parents(".wcbv-row:first").data("variation",c),v()}}).on("hide_variation",function(e){a&&c&&a.parents(".wcbv-row:first").data("variation","").removeClass("wcbv-show-price"),v()}),n.on("click",":submit",function(t){var i,a;t.preventDefault(),a=!0,e.find(".wcbv-fields > div").removeClass("wcbv-error").find("select").each(function(e,t){0==t.value.length&&(jQuery(t).parent("div").addClass("wcbv-error"),a=!1)}),a&&!n.find(".single_add_to_cart_button").hasClass("disabled")&&(n.find('[name="_wcbv_variations"]').val(JSON.stringify((i=[],e.find(".wcbv-variations .wcbv-row").each(function(e,t){var n=jQuery(t);if(n.data("variation")&&n.find(".wcbv-quantity input").val().length>0){var a=n.find(".wcbv-quantity input").val(),c=n.data("variation");!isNaN(a)&&a>0&&(c.wcbv_quantity=parseInt(n.find(".wcbv-quantity input").val()),i.push(c))}}),i))),"undefined"!=typeof fancyProductDesigner&&n.find('[name="_wcbv_fpd_price"]').val(parseFloat(fancyProductDesigner.calculatePrice())),setTimeout(function(){n.submit()},10))}),"undefined"!=typeof fancyProductDesigner&&jQuery(".fpd-container").on("priceChange",function(){v()}),void 0===wcbvOptions.fixedAmount||0===wcbvOptions.fixedAmount)r(wcbvOptions.selectedAttributes);else for(var u=0;u<wcbvOptions.fixedAmount;++u)r(wcbvOptions.selectedAttributes)});